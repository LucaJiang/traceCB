{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to traceCB","text":"<p>Important Notice</p> <p>Xinyi Yu from CUHK(SZ) has no contribution to this project. Adding individuals who have made no contribution to the list of authors constitutes academic misconduct. I personally strongly condemn this practice.</p> <p>traceCB is a Python package for Trans-ancestry cell-type-specific eQTL effects mapping by integrating sCRNA-seq and Bulk data.</p> <p></p> <p>Key Capabilities</p> <p>traceCB enables researchers to:</p> <ul> <li>Integrate single-cell and bulk eQTL data for trans-ancestry ct-eQTL mapping</li> <li>Estimator Method of Moments for efficient computation</li> <li>Perform powerful while maintaining type I error control</li> </ul>"},{"location":"#features","title":"Features","text":"<ul> <li> <p> Integration     ---     Seamlessly combines single-cell precision with bulk data scale for enhanced biological insights.</p> </li> <li> <p> Trans-ancestry     ---     Leverages genetic diversity across populations to identify robust and causal signals.</p> </li> <li> <p> Efficiency     ---     optimized numeric computing kernel using <code>numba</code> ensures high-performance analysis on large datasets.</p> </li> </ul>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#installation","title":"Installation","text":"<p>Prerequisites: Python &gt;= 3.8</p> <pre><code>git clone https://github.com/lucajiang/traceCB.git\ncd traceCB\npip install -e .\n</code></pre>"},{"location":"#documentation","title":"Documentation","text":"<p>Explore our documentation to learn how to use traceCB:</p> <ul> <li>Pipeline Workflow - Detailed steps for data preprocessing.</li> <li>API Reference - Documentation for core functions.</li> <li>Tutorial - Jupyter notebook example.</li> </ul>"},{"location":"#citation","title":"Citation","text":"<p>If you use traceCB in your research, please cite our paper:</p> <p>Citation pending...</p>"},{"location":"#support","title":"Support","text":"<p>For any questions or issues, please contact wx.jiang@my.cityu.edu.hk or open an issue on GitHub.</p>"},{"location":"api_reference/","title":"API Reference","text":"<p>This page provides detailed documentation for the core functions in the <code>traceCB</code> package.</p> <ul> <li>API Reference</li> <li>traceCB.gmm<ul> <li><code>GMM</code></li> <li><code>GMMtissue</code></li> </ul> </li> <li>traceCB.ldsc<ul> <li><code>Run_Single_LDSC</code></li> <li><code>Run_Cross_LDSC</code></li> </ul> </li> </ul>"},{"location":"api_reference/#tracecbgmm","title":"traceCB.gmm","text":"<p>Core functions for the Generalized Method of Moments (GMM) estimation.</p>"},{"location":"api_reference/#gmm","title":"<code>GMM</code>","text":"<p>Apply cross-population GMM (without tissue-specific information) to estimate effect sizes.</p> <pre><code>def GMM(\n    Omega: np.ndarray,\n    C: np.ndarray,\n    beta1: float,\n    se1: float,\n    ld1: float,\n    beta2: float,\n    se2: float,\n    ld2: float,\n    ldx: float,\n) -&gt; tuple[float, float, float, float]\n</code></pre> <p>Parameters</p> <ul> <li>Omega (<code>np.ndarray</code>): A (2, 2) per-SNP covariance matrix.</li> <li>C (<code>np.ndarray</code>): A (2, 2) genetic drift matrix estimated from LDSC.</li> <li>beta1 (<code>float</code>): Effect size (beta) for the SNP in population 1.</li> <li>se1 (<code>float</code>): Standard error for the SNP in population 1.</li> <li>ld1 (<code>float</code>): LD score between the SNP and the rest of the SNPs in the target gene in population 1.</li> <li>beta2 (<code>float</code>): Effect size (beta) for the SNP in population 2.</li> <li>se2 (<code>float</code>): Standard error for the SNP in population 2.</li> <li>ld2 (<code>float</code>): LD score between the SNP and the rest of the SNPs in the target gene in population 2.</li> <li>ldx (<code>float</code>): Cross-population LD score for the SNP between population 1 and population 2.</li> </ul> <p>Returns</p> <ul> <li>beta1_blue (<code>float</code>): GMM estimate (BLUE) for population 1.</li> <li>se1_blue (<code>float</code>): Standard error of the GMM estimate for population 1.</li> <li>beta2_blue (<code>float</code>): GMM estimate (BLUE) for population 2.</li> <li>se2_blue (<code>float</code>): Standard error of the GMM estimate for population 2.</li> </ul>"},{"location":"api_reference/#gmmtissue","title":"<code>GMMtissue</code>","text":"<p>Apply cross-population GMM incorporating tissue-specific information (e.g., from scRNA-seq derived eQTLs).</p> <pre><code>def GMMtissue(\n    Omega: np.ndarray,\n    C: np.ndarray,\n    beta1: float,\n    se1: float,\n    ld1: float,\n    beta2: float,\n    se2: float,\n    ld2: float,\n    ldx: float,\n    beta_t: float,\n    se_t: float,\n    pi2_omega_o: float,\n    propt: float,\n) -&gt; tuple[float, float, float, float]\n</code></pre> <p>Parameters</p> <ul> <li>Omega (<code>np.ndarray</code>): A (2, 2) per-SNP covariance matrix.</li> <li>C (<code>np.ndarray</code>): A (3, 3) genetic drift matrix estimated from LDSC.</li> <li>beta1 (<code>float</code>): Effect size (beta) for the SNP in population 1.</li> <li>se1 (<code>float</code>): Standard error for the SNP in population 1.</li> <li>ld1 (<code>float</code>): LD score for population 1.</li> <li>beta2 (<code>float</code>): Effect size (beta) for the SNP in population 2.</li> <li>se2 (<code>float</code>): Standard error for the SNP in population 2.</li> <li>ld2 (<code>float</code>): LD score for population 2.</li> <li>ldx (<code>float</code>): Cross-population LD score.</li> <li>beta_t (<code>float</code>): Effect size (beta) for the SNP in the specific tissue/cell-type.</li> <li>se_t (<code>float</code>): Standard error for the SNP in the specific tissue/cell-type.</li> <li>pi2_omega_o (<code>float</code>): Variance component of other cell types within the tissue.</li> <li>propt (<code>float</code>): Proportion of the specific cell type in the tissue.</li> </ul> <p>Returns</p> <ul> <li>beta1_blue (<code>float</code>): GMM estimate for population 1.</li> <li>se1_blue (<code>float</code>): Standard error for population 1.</li> <li>beta2_blue (<code>float</code>): GMM estimate for population 2.</li> <li>se2_blue (<code>float</code>): Standard error for population 2.</li> </ul>"},{"location":"api_reference/#tracecbldsc","title":"traceCB.ldsc","text":"<p>Functions for running Single and Cross-Population LD Score Regression (LDSC).</p>"},{"location":"api_reference/#run_single_ldsc","title":"<code>Run_Single_LDSC</code>","text":"<p>Run LDSC regression to estimate heritability ($h^2$) in a single population.</p> <pre><code>def Run_Single_LDSC(\n    zscore: np.ndarray,\n    n: np.ndarray,\n    ldscore: np.ndarray,\n    intercept: float = np.nan,\n) -&gt; tuple[float, float]\n</code></pre> <p>Parameters</p> <ul> <li>zscore (<code>np.ndarray</code>): Array of Z-scores for SNPs, shape <code>(num_SNP,)</code>.</li> <li>n (<code>np.ndarray</code>): Array of sample sizes for each SNP, shape <code>(num_SNP,)</code>.</li> <li>ldscore (<code>np.ndarray</code>): Array of LD scores, shape <code>(num_SNP,)</code>.</li> <li>intercept (<code>float</code>, optional): Fixed intercept value. If <code>np.nan</code> (default), the intercept is estimated from the data.</li> </ul> <p>Returns</p> <ul> <li>h2 (<code>float</code>): Estimated heritability. (Clipped to be $\\ge$ MIN_HERITABILITY).</li> <li>h2_se (<code>float</code>): Standard error of the heritability estimate.</li> </ul>"},{"location":"api_reference/#run_cross_ldsc","title":"<code>Run_Cross_LDSC</code>","text":"<p>Run LDSC regression to estimate genetic covariance ($\\Omega$) between two populations.</p> <pre><code>def Run_Cross_LDSC(\n    zscore1: np.ndarray,\n    n1: np.ndarray,\n    ldscore1: np.ndarray,\n    zscore2: np.ndarray,\n    n2: np.ndarray,\n    ldscore2: np.ndarray,\n    crossld: np.ndarray,\n    intercept: np.ndarray = np.array([np.nan, np.nan, np.nan]),\n) -&gt; tuple[np.ndarray, np.ndarray]\n</code></pre> <p>Parameters</p> <ul> <li>zscore1 (<code>np.ndarray</code>): Z-scores for population 1.</li> <li>n1 (<code>np.ndarray</code>): Sample sizes for population 1.</li> <li>ldscore1 (<code>np.ndarray</code>): LD scores for population 1.</li> <li>zscore2 (<code>np.ndarray</code>): Z-scores for population 2.</li> <li>n2 (<code>np.ndarray</code>): Sample sizes for population 2.</li> <li>ldscore2 (<code>np.ndarray</code>): LD scores for population 2.</li> <li>crossld (<code>np.ndarray</code>): Cross-population LD scores.</li> <li>intercept (<code>np.ndarray</code>, optional): Array of intercept values <code>[h11, h22, h12]</code>. Default is <code>[nan, nan, nan]</code>, which estimates all intercepts.</li> </ul> <p>Returns</p> <ul> <li>Omega (<code>np.ndarray</code>): Estimated genetic covariance matrix of shape <code>(2, 2)</code>.</li> <li><code>Omega[0, 0]</code>: Heritability pop 1</li> <li><code>Omega[1, 1]</code>: Heritability pop 2</li> <li><code>Omega[0, 1]</code> / <code>Omega[1, 0]</code>: Genetic covariance</li> <li>Omega_se (<code>np.ndarray</code>): Standard error matrix for <code>Omega</code>, shape <code>(2, 2)</code>.</li> </ul>"},{"location":"pipeline/","title":"HowTO: Run traceCB pipeline","text":"<p>This guide details the steps to preprocess data, execute the traceCB GMM model, and visualize the results.</p> <p>All logs will be saved to your specified <code>log_path</code>. Please review the log files carefully for any warnings or errors.</p> <p>Warning</p> <p>If you use your own eQTL data, ensure the input data format matches the specifications described below exactly to avoid runtime errors.</p>"},{"location":"pipeline/#workflow-overview","title":"Workflow Overview","text":"<pre><code>graph LR\n    A[Raw Data] --&gt; B[Preprocessing];\n    B --&gt; C[Alignment &lt;br&gt; LD Annotation];\n    C --&gt; D[GMM];\n    D --&gt; E[Visualization];\n    D --&gt; F[Colocalization];</code></pre>"},{"location":"pipeline/#preprocessing","title":"Preprocessing","text":"<p>Data sources and software used in our study (and supported by default):</p> <p>Data Sources:</p> <ul> <li>eQTLCatalogue: Tabix Index</li> <li>GTEx: Google Cloud or Portal</li> <li>eQTLGen: Official Site</li> <li>BBJ: Official Site</li> <li>1000G: Plink2 Resource</li> <li>PopCell (AFR): Nature 2023. Restricted Access - Apply Here.</li> </ul> <p>Software:</p> <ul> <li>S-LDXR: GitHub Algo</li> <li>Plink1.9: Official Site</li> <li>Cibersortx: Official Site used for cell type proportion estimation from GTEx data.</li> <li>COLOC: CRAN Package used for colocalization analysis (optional).</li> </ul>"},{"location":"pipeline/#format-data-by-chromosome","title":"Format Data by Chromosome","text":"<p>To optimize Python loading times, we split and format the data by chromosome.</p> GTExBBJeQTLCataloguePopCell (AFR) <p>To process GTEx Whole Blood data:</p> <p><code>shell/GTEx_Preprocess.sh</code></p> <p>Input Format (<code>GTEx_Analysis_v8_QTLs-GTEx_Analysis_v8_eQTL_all_associations-Whole_Blood.allpairs.txt.gz</code>)</p> gene_id variant_id tss_distance ma_samples ma_count maf pval_nominal ... ENSG00000227232.5 chr1_13550_G_A_b38 -16003 19 19 0.014 0.734 ... <p>Output Format (<code>chr22.csv</code>)</p> GENE RSID CHR POS TSS_DISTANCE A1 A2 MAF PVAL BETA SE ENSG00000008735 rs117049661 22 49600902 -999783 T C 0.0067 0.613 0.133 0.263 <p>To process BBJ cell type data:</p> <p><code>shell/BBJ_Preprocess.sh</code></p> <p>Input Format (<code>chr22_cis_eqtl_mapping_nofilt_nomulti_with_alleles.txt.gz</code>)</p> SNP POS REF ALT gene beta t-stat p-value chr22:16201313:I 16201313 A AG ENSG00000100181.17 0.114 0.355 0.722 <p>Output Format (<code>chr22.csv</code>)</p> CHR RSID POS A2 A1 GENE BETA Z PVAL 22 rs1000427 36890105 G A ENSG00000100055 -0.152 -0.858 0.392 <p>To process eQTLCatalogue data:</p> <p><code>shell/eQTLCatalogue_Preprocess.sh</code></p> <p>Input Format (<code>QTD000031.all.tsv.gz</code>)</p> molecular_trait_id chromosome position ref alt variant ... beta se ENSG00000187583 1 14464 A T chr1_14464_A_T ... 0.185 NP <p>Output Format (<code>chr22.csv</code>)</p> CHR RSID GENE POS A1 A2 BETA SE PVAL Z N 22 rs5747203 ENSG00000015475 17493644 A G -0.040 0.148 0.786 -0.270 167 <p>To process African Population data from Aquino et al. (2023):</p> <p>Source: Dissecting human population variation in single-cell responses to SARS-CoV-2, Nature (2023).</p> <p>Data Access Control</p> <p>This dataset requires specific application for access.  Please visit the Owey Dataset Portal for application details.</p> <p>Preprocessing Pipeline:</p> <p>Please refer to the external repository popCell_SARS-CoV-2 for upstream processing scripts.  Ensure the final output is formatted to match the <code>traceCB</code> standard (see other tabs).</p>"},{"location":"pipeline/#cell-type-information-proportion","title":"Cell Type Information &amp; Proportion","text":""},{"location":"pipeline/#eqtlcatalogue-id-and-cell-types","title":"eQTLCatalogue ID and Cell Types","text":"ID Dataset (N) Cell Type <code>QTD000021</code> BLUEPRINT (191) Monocytes <code>QTD000069</code> CEDAR (286) Monocytes <code>QTD000081</code> Fairfax_2014 (420) Monocytes <code>QTD000031</code> BLUEPRINT (167) CD4+ T cells <code>QTD000067</code> CEDAR (290) CD4+ T cells <code>QTD000371</code> Kasela_2017 (280) CD4+ T cells <code>QTD000066</code> CEDAR (277) CD8+ T cells <code>QTD000372</code> Kasela_2017 (269) CD8+ T cells <code>QTD000073</code> CEDAR (262) B cells <code>QTD000115</code> Gilchrist_2021 (247) NK cells"},{"location":"pipeline/#proportion-calculation","title":"Proportion Calculation","text":"<p>You can use any method to obtain cell type proportions. We recommend using GTEx whole blood TPM files with Cibersortx.</p> <p>Example Output (<code>cell_type_proportion.csv</code>): <pre><code>Cell_type,Proportion\nB_cells,0.8069001744805046\nPCs,0.30700693083630154\nCD4+T_cells,10.401165801186464\n...\n</code></pre></p>"},{"location":"pipeline/#alignment","title":"Alignment","text":"<p>Run <code>src/preprocess/MergeChr.py</code> via <code>shell/run_merge.sh</code> to align all input data files. </p> <ul> <li>Results will be saved to <code>save_path_main</code>.</li> <li>The cell type proportion file will strictly accompany the aligned data.</li> </ul> <p>Directory Structure: <pre><code>&lt;save_path_main&gt;/EAS_GTEx/QTD000021/\n\u251c\u2500\u2500 AUX_Monocytes/\n\u251c\u2500\u2500 INFO/\n\u251c\u2500\u2500 TAR_Monocytes/\n\u2514\u2500\u2500 Tissue/\n</code></pre></p>"},{"location":"pipeline/#annotation-ld-scores","title":"Annotation &amp; LD Scores","text":""},{"location":"pipeline/#1-annotate-ld","title":"1. Annotate LD","text":"<p>Run <code>src/preprocess/create_ld_annot.py</code> via <code>shell/run_ld.sh</code>. This step prepares 1000G data for <code>s-ldxr</code>.</p> <p>Note</p> <p>Requires <code>pysnptools</code> and <code>statsmodels</code> to run s-ldxr. Ensure these are installed in your Python environment.</p> <p>Input: <code>1000G.&lt;pop&gt;.QC.maf.@.bed/bim/fam</code></p> <p>Output: <pre><code>&lt;save_path_main&gt;/EAS_GTEx/QTD000021/LDSC/LD_annotation:\n1.print_snps.txt\n1.annot.gz\n...\n</code></pre></p>"},{"location":"pipeline/#2-run-s-ldxr","title":"2. Run s-ldxr","text":"<p>Use <code>shell/run_ld.sh</code> to calculate gene-level LD scores.</p> <p>Failure</p> <p><pre><code>IndexError: index 16464 is out of bounds for axis 0 with size 16464\n</code></pre> This usually indicates an alignment mismatch. Check if all input files are correctly aligned.</p>"},{"location":"pipeline/#gmm-modeling","title":"GMM Modeling","text":"<p>After preprocessing, your study folder should follow this structure:</p> <pre><code>.\n\u251c\u2500\u2500 AUX_Monocytes\n\u251c\u2500\u2500 celltype_proportion.csv\n\u251c\u2500\u2500 gene_snp_count\n\u251c\u2500\u2500 INFO\n\u251c\u2500\u2500 LDSC\n\u251c\u2500\u2500 TAR_Monocytes\n\u2514\u2500\u2500 Tissue\n</code></pre> <p>Execute <code>shell/run_gmm.sh</code> (wraps <code>src/traceCB/run_gmm.py</code>) to run the GMM model.</p>"},{"location":"pipeline/#output-files","title":"Output Files","text":"<p>The results are saved in Parquet notation for performance.</p> <p>1. Gene-level Results (<code>ENSG@.parquet</code>)</p> <p>Contains detailed effect size estimates for Target (TAR), Auxiliary (AUX), and Tissue populations under different models (S: Summary, C: Cross-pop, T: Tissue-enhanced).</p> RSID TAR_SBETA TAR_CBETA TAR_TBETA TAR_SPVAL ... rs10985869 -0.513 -0.515 -0.637 0.0009 ... <p>2. Chromosome Summary (<code>summary.csv</code>)</p> <p>Contains heritability estimates ($h^2$) and effective sample sizes ($N_{eff}$).</p> GENE NSNP H1SQ H2SQ TAR_SNEFF ... ENSG...63 2321 7.49e-05 2.53e-04 269.05 ... <p>Note</p> <p>We use <code>numba</code> with <code>jit</code> and <code>nogil</code> for high-performance computing. If you need to debug, you can comment out the <code>@</code> decorators in the source code, though this will significantly slow down execution.</p>"},{"location":"pipeline/#colocalization","title":"Colocalization","text":""},{"location":"pipeline/#prerequisites","title":"Prerequisites","text":"<ul> <li>LDlinkR API Token (Required for <code>src/coloc/run_ldlink.R</code>)</li> <li>Bedtools: <code>closestBed</code> binary</li> <li>References: hg19/GRCh37 cytoband, Gene Annotation BED</li> </ul>"},{"location":"pipeline/#1-leading-snp-annotation","title":"1. Leading SNP Annotation","text":"<p>Run <code>src/coloc/find_leadingSNP.py</code>:</p> <pre><code>python src/coloc/find_leadingSNP.py \\\n  --gwas_sumstats_path &lt;PATH&gt; \\\n  --save_path &lt;OUTPUT&gt; \\\n  --save_prefix &lt;PREFIX&gt;\n</code></pre> <p>Key Outputs: *   <code>{prefix}_loci.csv</code>: Final result merging SNP positions with closest Ensembl gene IDs.</p>"},{"location":"pipeline/#2-run-coloc","title":"2. Run COLOC","text":"<p>Use <code>shell/run_coloc.sh</code> to execute the colocalization analysis for each study.</p>"},{"location":"pipeline/#visualization","title":"Visualization","text":"<p>Visualization scripts are located in <code>src/visual/</code>.</p> <ul> <li>Logic: <code>src/visual/utils.py</code> selects which study to plot.</li> <li>Style: <code>src/visual/meta_data.json</code> defines colors, labels, and plot settings.</li> </ul> <p>To reproduce Figure 3 or Figure 5 from our paper, ensure the correct study is selected in <code>utils.py</code>.</p>"},{"location":"tutorial/","title":"Running the Tutorial","text":"<p>This tutorial provides a hands-on guide to applying <code>traceCB</code> using a sample dataset (provided as a \"toy example\") to analyze a single gene. We offer two methods to run this tutorial:</p> <ol> <li>Google Colab (Recommended): A cloud-based environment requiring no installation.</li> <li>Local Execution: Running the tutorial on your own machine.</li> </ol> <p>Consistent Results</p> <p>Both methods utilize the identical dataset and codebase in the background, ensuring consistent analytical results regardless of the execution environment. We recommend Google Colab for a quick start without setup overhead.</p>"},{"location":"tutorial/#option-1-quick-start-with-google-colab","title":"Option 1: Quick Start with Google Colab","text":"<p>For immediate exploration without configuring a local environment, use our Google Colab notebook.</p> <p>https://colab.research.google.com/drive/1kfmlbzRdgyQ1BjkBe10x82tuKNGL5xqt?usp=sharing</p> <p> </p> Figure 1: Snapshot of the traceCB tutorial in Google Colab."},{"location":"tutorial/#option-2-local-environment","title":"Option 2: Local Environment","text":"<p>For researchers preferring a local setup, the tutorial is available as a Jupyter Notebook.</p> <ol> <li>Install traceCB: Ensure you have installed the package and its dependencies (refer to the Installation Guide).</li> <li>Open the Notebook: Navigate to the tutorial notebook at <code>docs/tutorial/run_traceCB.ipynb</code> and open it with Jupyter Notebook or VS Code (or any compatible IDE).</li> <li>Run Locally: Execute the file to reproduce the analysis.</li> </ol>"}]}